#include "syntaxAnalyse.h"

void FirstSet(Rule *r);
Rule *getRuleByTag(char tag);

void FollowSet(Rule r){
	for (int i = 0; i < r.count; ++i)
	{
		char *cc = r.each[i];
		while(*(cc + 1) != 0){
			Rule *t = getRuleByTag(*cc);
			if (t == NULL){
				cc ++;
				continue;
			}
			Rule x;
			x.tag = 'X';
			x.each[0] = cc + 1;
			x.count = 1;
			FirstSet(&x);
			if (strchr(x.first, '@') != NULL)
			{
				if(*(r.follow) == 0)
					t->follow[strlen(t->follow)] = r.tag;
				else
					strcpy(t->follow + strlen(t->follow),r.follow);
			}
			strcpy(t->follow + strlen(t->follow),x.first);
			cc ++;
		}
		Rule *t = getRuleByTag(*cc);
		if(t != NULL){
			if(*(r.follow) == 0)
				t->follow[strlen(t->follow)] = r.tag;
			else
				strcpy(t->follow + strlen(t->follow),r.follow);
		}
	}
}
